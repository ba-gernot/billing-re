<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="https://www.omg.org/spec/DMN/20191111/MODEL/"
             xmlns:dmndi="https://www.omg.org/spec/DMN/20191111/DMNDI/"
             xmlns:dc="http://www.omg.org/spec/DMN/20180521/DC/"
             xmlns:di="http://www.omg.org/spec/DMN/20180521/DI/"
             id="LeistungsErmittlungRegeln"
             name="Service Determination Rules"
             namespace="http://billing-re.example.com/dmn">

  <decision id="ServiceDetermination" name="Service Determination">
    <decisionTable id="DecisionTable_ServiceDetermination" hitPolicy="COLLECT">

      <!-- Input columns -->
      <input id="Input_TransportType" label="Transport Type">
        <inputExpression id="Expression_TransportType" typeRef="string">
          <text>transportType</text>
        </inputExpression>
      </input>

      <input id="Input_DangerousGoods" label="Dangerous Goods">
        <inputExpression id="Expression_DangerousGoods" typeRef="boolean">
          <text>dangerousGoods</text>
        </inputExpression>
      </input>

      <input id="Input_ServiceType" label="Service Type">
        <inputExpression id="Expression_ServiceType" typeRef="string">
          <text>serviceType</text>
        </inputExpression>
      </input>

      <input id="Input_LoadingStatus" label="Loading Status">
        <inputExpression id="Expression_LoadingStatus" typeRef="string">
          <text>loadingStatus</text>
        </inputExpression>
      </input>

      <input id="Input_Date" label="Date">
        <inputExpression id="Expression_Date" typeRef="date">
          <text>departureDate</text>
        </inputExpression>
      </input>

      <input id="Input_Station" label="Station">
        <inputExpression id="Expression_Station" typeRef="string">
          <text>departureStation</text>
        </inputExpression>
      </input>

      <!-- Output column -->
      <output id="Output_ServiceCode" label="Service Code" typeRef="string"/>

      <!-- Rules from roadmap Section 3-4 -->

      <!-- Rule 1: KV + Dangerous + Date Range (highest priority) -->
      <rule id="Rule_KVDangerousDateRange">
        <inputEntry id="Rule1_TransportType">
          <text>"KV"</text>
        </inputEntry>
        <inputEntry id="Rule1_DangerousGoods">
          <text>true</text>
        </inputEntry>
        <inputEntry id="Rule1_ServiceType">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule1_LoadingStatus">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule1_Date">
          <text>[date("2025-05-01")..date("2025-08-31")]</text>
        </inputEntry>
        <inputEntry id="Rule1_Station">
          <text>-</text>
        </inputEntry>
        <outputEntry id="Rule1_Output">
          <text>"456"</text>
        </outputEntry>
      </rule>

      <!-- Rule 2: Main + Loaded/Empty + KV + Dangerous -->
      <rule id="Rule_MainKVDangerous">
        <inputEntry id="Rule2_TransportType">
          <text>"KV"</text>
        </inputEntry>
        <inputEntry id="Rule2_DangerousGoods">
          <text>true</text>
        </inputEntry>
        <inputEntry id="Rule2_ServiceType">
          <text>"MAIN"</text>
        </inputEntry>
        <inputEntry id="Rule2_LoadingStatus">
          <text>"beladen", "leer"</text>
        </inputEntry>
        <inputEntry id="Rule2_Date">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule2_Station">
          <text>-</text>
        </inputEntry>
        <outputEntry id="Rule2_Output">
          <text>"456"</text>
        </outputEntry>
      </rule>

      <!-- Rule 3: Main + Any + KV -->
      <rule id="Rule_MainKV">
        <inputEntry id="Rule3_TransportType">
          <text>"KV"</text>
        </inputEntry>
        <inputEntry id="Rule3_DangerousGoods">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule3_ServiceType">
          <text>"MAIN"</text>
        </inputEntry>
        <inputEntry id="Rule3_LoadingStatus">
          <text>"beladen", "leer"</text>
        </inputEntry>
        <inputEntry id="Rule3_Date">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule3_Station">
          <text>-</text>
        </inputEntry>
        <outputEntry id="Rule3_Output">
          <text>"444"</text>
        </outputEntry>
      </rule>

      <!-- Rule 4: Main + Any -->
      <rule id="Rule_MainGeneric">
        <inputEntry id="Rule4_TransportType">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule4_DangerousGoods">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule4_ServiceType">
          <text>"MAIN"</text>
        </inputEntry>
        <inputEntry id="Rule4_LoadingStatus">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule4_Date">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule4_Station">
          <text>-</text>
        </inputEntry>
        <outputEntry id="Rule4_Output">
          <text>"111"</text>
        </outputEntry>
      </rule>

      <!-- Rule 5: Trucking + Any -->
      <rule id="Rule_TruckingGeneric">
        <inputEntry id="Rule5_TransportType">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule5_DangerousGoods">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule5_ServiceType">
          <text>"TRUCKING"</text>
        </inputEntry>
        <inputEntry id="Rule5_LoadingStatus">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule5_Date">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule5_Station">
          <text>-</text>
        </inputEntry>
        <outputEntry id="Rule5_Output">
          <text>"222"</text>
        </outputEntry>
      </rule>

      <!-- Rule 6: Station Security Hamburg -->
      <rule id="Rule_StationSecurity">
        <inputEntry id="Rule6_TransportType">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule6_DangerousGoods">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule6_ServiceType">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule6_LoadingStatus">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule6_Date">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule6_Station">
          <text>"80155283", "80137943"</text>
        </inputEntry>
        <outputEntry id="Rule6_Output">
          <text>"333"</text>
        </outputEntry>
      </rule>

      <!-- Rule 7: Additional Service exists -->
      <rule id="Rule_AdditionalService">
        <inputEntry id="Rule7_TransportType">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule7_DangerousGoods">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule7_ServiceType">
          <text>"ADDITIONAL"</text>
        </inputEntry>
        <inputEntry id="Rule7_LoadingStatus">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule7_Date">
          <text>-</text>
        </inputEntry>
        <inputEntry id="Rule7_Station">
          <text>-</text>
        </inputEntry>
        <outputEntry id="Rule7_Output">
          <text>"789"</text>
        </outputEntry>
      </rule>

    </decisionTable>
  </decision>

</definitions>